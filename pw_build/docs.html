

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pw_build &mdash; Pigweed</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pw_bytes" href="../pw_bytes/docs.html" />
    <link rel="prev" title="pw_boot_armv7m" href="../pw_boot_armv7m/docs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pigweed
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed.googlesource.com/pigweed/pigweed/+/refs/heads/master">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed-review.googlesource.com">Code Reviews</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/pigweed">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/M9NSeTA">Chat Room</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bugs.chromium.org/p/pigweed/issues/list">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/embedded_cpp_guide.html">Embedded C++ Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/style_guide.html">Code Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_system.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/module_structure.html">Module Structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../module_guides.html">Module Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../docker/docs.html">docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_allocator/docs.html">pw_allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_arduino_build/docs.html">pw_arduino_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert/docs.html">pw_assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_basic/docs.html">pw_assert_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_log/docs.html">pw_assert_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_base64/docs.html">pw_base64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bloat/docs.html">pw_bloat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_blob_store/docs.html">pw_blob_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_boot_armv7m/docs.html">pw_boot_armv7m</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">pw_build</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#gn-ninja">GN / Ninja</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#templates">Templates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#cmake-ninja">CMake / Ninja</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#cmake-functions">CMake functions</a></li>
<li class="toctree-l4"><a class="reference internal" href="#use-pigweed-from-an-existing-cmake-project">Use Pigweed from an existing CMake project</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#id1">Bazel</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bytes/docs.html">pw_bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_checksum/docs.html">pw_checksum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cli/docs.html">pw_cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_containers/docs.html">pw_containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception/docs.html">pw_cpu_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception_armv7m/docs.html">pw_cpu_exception_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_docgen/docs.html">pw_docgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_doctor/docs.html">pw_doctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_env_setup/docs.html">pw_env_setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_fuzzer/docs.html">pw_fuzzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hdlc_lite/docs.html">pw_hdlc_lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hex_dump/docs.html">pw_hex_dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_kvs/docs.html">pw_kvs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log/docs.html">pw_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_basic/docs.html">pw_log_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_null/docs.html">pw_log_null</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_rpc/docs.html">pw_log_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_tokenized/docs.html">pw_log_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_metric/docs.html">pw_metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_minimal_cpp_stdlib/docs.html">pw_minimal_cpp_stdlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_module/docs.html">pw_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_polyfill/docs.html">pw_polyfill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_preprocessor/docs.html">pw_preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_presubmit/docs.html">pw_presubmit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf/docs.html">pw_protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf_compiler/docs.html">pw_protobuf_compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_random/docs.html">pw_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_result/docs.html">pw_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_ring_buffer/docs.html">pw_ring_buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_rpc/docs.html">pw_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_span/docs.html">pw_span</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_status/docs.html">pw_status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_stream/docs.html">pw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_string/docs.html">pw_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io/docs.html">pw_sys_io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_arduino/docs.html">pw_sys_io_arduino</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_baremetal_stm32f429/docs.html">pw_sys_io_baremetal_stm32f429</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_stdio/docs.html">pw_sys_io_stdio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_target_runner/docs.html">pw_target_runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_tokenizer/docs.html">pw_tokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_toolchain/docs.html">pw_toolchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace/docs.html">pw_trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace_tokenized/docs.html">pw_trace_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_unit_test/docs.html">pw_unit_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_varint/docs.html">pw_varint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_watch/docs.html">pw_watch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_web_ui/docs.html">pw_web_ui</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pigweed</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../module_guides.html">Module Guides</a> &raquo;</li>
        
      <li>pw_build</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pw-build">
<span id="module-pw-build"></span><h1>pw_build<a class="headerlink" href="#pw-build" title="Permalink to this headline">¶</a></h1>
<p>Pigweed’s modules aim to be easily integratable into both new and existing
embedded projects. To that goal, the <code class="docutils literal notranslate"><span class="pre">pw_build</span></code> module provides support for
multiple build systems. Our personal favorite is <a class="reference external" href="https://gn.googlesource.com/gn/">GN</a>/<a class="reference external" href="https://ninja-build.org/">Ninja</a>, which is used
by upstream developers for its speed and flexibility. <a class="reference external" href="https://cmake.org/">CMake</a> and <a class="reference external" href="https://bazel.build/">Bazel</a>
build files are also provided by all modules, allowing Pigweed to be added to a
project with minimal effort.</p>
<p>Beyond just compiling code, Pigweed’s GN build system can also:</p>
<ul class="simple">
<li><p>Generate HTML documentation, via our Sphinx integration (with <code class="docutils literal notranslate"><span class="pre">pw_docgen</span></code>)</p></li>
<li><p>Display memory usage report cards (with <code class="docutils literal notranslate"><span class="pre">pw_bloat</span></code>)</p></li>
<li><p>Incrementally run unit tests after code changes (with <code class="docutils literal notranslate"><span class="pre">pw_target_runner</span></code>)</p></li>
<li><p>And more!</p></li>
</ul>
<p>These are only supported in the GN build, so we recommend using it if possible.</p>
<div class="section" id="gn-ninja">
<h2>GN / Ninja<a class="headerlink" href="#gn-ninja" title="Permalink to this headline">¶</a></h2>
<p>The GN / Ninja build system is the primary build system used for upstream
Pigweed development, and is the most tested and feature-rich build system
Pigweed offers.</p>
<p>This module’s <code class="docutils literal notranslate"><span class="pre">build.gn</span></code> file contains a number of C/C++ <code class="docutils literal notranslate"><span class="pre">config</span></code>
declarations that are used by upstream Pigweed to set some architecture-agnostic
compiler defaults. (See Pigweed’s <code class="docutils literal notranslate"><span class="pre">//BUILDCONFIG.gn</span></code>)</p>
<p><code class="docutils literal notranslate"><span class="pre">pw_build</span></code> also provides several useful GN templates that are used throughout
Pigweed.</p>
<div class="section" id="templates">
<h3>Templates<a class="headerlink" href="#templates" title="Permalink to this headline">¶</a></h3>
<div class="section" id="target-types">
<h4>Target types<a class="headerlink" href="#target-types" title="Permalink to this headline">¶</a></h4>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="p">(</span><span class="s2">&quot;$dir_pw_build/target_types.gni&quot;</span><span class="p">)</span>

<span class="n">pw_source_set</span><span class="p">(</span><span class="s2">&quot;my_library&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;lib.cc&quot;</span> <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Pigweed defines wrappers around the four basic GN binary types <code class="docutils literal notranslate"><span class="pre">source_set</span></code>,
<code class="docutils literal notranslate"><span class="pre">executable</span></code>, <code class="docutils literal notranslate"><span class="pre">static_library</span></code>, and <code class="docutils literal notranslate"><span class="pre">shared_library</span></code>. These wrappers apply
default arguments to each target as specified in the <code class="docutils literal notranslate"><span class="pre">default_configs</span></code> and
<code class="docutils literal notranslate"><span class="pre">default_public_deps</span></code> build args. Additionally, they allow defaults to be
removed on a per-target basis using <code class="docutils literal notranslate"><span class="pre">remove_configs</span></code> and
<code class="docutils literal notranslate"><span class="pre">remove_public_deps</span></code> variables, respectively.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pw_executable</span></code> template provides additional functionality around building
complete binaries. As Pigweed is a collection of libraries, it does not know how
its final targets are built. <code class="docutils literal notranslate"><span class="pre">pw_executable</span></code> solves this by letting each user
of Pigweed specify a global executable template for their target, and have
Pigweed build against it. This is controlled by the build variable
<code class="docutils literal notranslate"><span class="pre">pw_executable_config.target_type</span></code>, specifying the name of the executable
template for a project.</p>
<div class="admonition tip">
<p class="admonition-title">Tip</p>
<p>Prefer to use <code class="docutils literal notranslate"><span class="pre">pw_executable</span></code> over plain <code class="docutils literal notranslate"><span class="pre">executable</span></code> targets to allow
cleanly building the same code for multiple target configs.</p>
</div>
<p><strong>Arguments</strong></p>
<p>All of the <code class="docutils literal notranslate"><span class="pre">pw_*</span></code> target type overrides accept any arguments, as they simply
forward them through to the underlying target.</p>
</div>
<div class="section" id="pw-python-script">
<span id="module-pw-build-python-script"></span><h4>pw_python_script<a class="headerlink" href="#pw-python-script" title="Permalink to this headline">¶</a></h4>
<p>The <code class="docutils literal notranslate"><span class="pre">pw_python_script</span></code> template is a convenience wrapper around <code class="docutils literal notranslate"><span class="pre">action</span></code> for
running Python scripts. The main benefit it provides is resolution of GN target
labels to compiled binary files. This allows Python scripts to be written
independently of GN, taking only filesystem paths as arguments.</p>
<p>Another convenience provided by the template is to allow running scripts without
any outputs. Sometimes scripts run in a build do not directly produce output
files, but GN requires that all actions have an output. <code class="docutils literal notranslate"><span class="pre">pw_python_script</span></code>
solves this by accepting a boolean <code class="docutils literal notranslate"><span class="pre">stamp</span></code> argument which tells it to create a
dummy output file for the action.</p>
<p><strong>Arguments</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">pw_python_script</span></code> accepts all of the arguments of a regular <code class="docutils literal notranslate"><span class="pre">action</span></code>
target. Additionally, it has some of its own arguments:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">capture_output</span></code>: Optional boolean. If true, script output is hidden unless
the script fails with an error. Defaults to true.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">stamp</span></code>: Optional variable indicating whether to automatically create a
dummy output file for the script. This allows running scripts without
specifying <code class="docutils literal notranslate"><span class="pre">outputs</span></code>. If <code class="docutils literal notranslate"><span class="pre">stamp</span></code> is true, a generic output file is
used. If <code class="docutils literal notranslate"><span class="pre">stamp</span></code> is a file path, that file is used as a stamp file. Like any
output file, <code class="docutils literal notranslate"><span class="pre">stamp</span></code> must be in the build directory. Defaults to false.</p></li>
</ul>
<p><strong>Expressions</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">pw_python_script</span></code> evaluates expressions in <code class="docutils literal notranslate"><span class="pre">args</span></code>, the arguments passed to
the script. These expressions function similarly to generator expressions in
CMake. Expressions may be passed as a standalone argument or as part of another
argument. A single argument may contain multiple expressions.</p>
<p>Generally, these expressions are used within templates rather than directly in
BUILD.gn files. This allows build code to use GN labels without having to worry
about converting them to files.</p>
<p>The following expressions are supported:</p>
<dl class="describe">
<dt>
<code class="sig-name descname">&lt;TARGET_FILE(gn_target)&gt;</code></dt>
<dd><p>Evaluates to the output file of the provided GN target. For example, the
expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;TARGET_FILE(//foo/bar:static_lib)&gt;&quot;</span>
</pre></div>
</div>
<p>might expand to</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;/home/User/project_root/out/obj/foo/bar/static_lib.a&quot;</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">TARGET_FILE</span></code> parses the <code class="docutils literal notranslate"><span class="pre">.ninja</span></code> file for the GN target, so it should
always find the correct output file, regardless of the toolchain’s or target’s
configuration. Some targets, such as <code class="docutils literal notranslate"><span class="pre">source_set</span></code> and <code class="docutils literal notranslate"><span class="pre">group</span></code> targets, do
not have an output file, and attempting to use <code class="docutils literal notranslate"><span class="pre">TARGET_FILE</span></code> with them
results in an error.</p>
<p><code class="docutils literal notranslate"><span class="pre">TARGET_FILE</span></code> only resolves GN target labels to their outputs. To resolve
paths generally, use the standard GN approach of applying the
<code class="docutils literal notranslate"><span class="pre">rebase_path(path)</span></code> function. With default arguments, <code class="docutils literal notranslate"><span class="pre">rebase_path</span></code>
converts the provided GN path or list of paths to be relative to the build
directory, from which all build commands and scripts are executed.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">&lt;TARGET_FILE_IF_EXISTS(gn_target)&gt;</code></dt>
<dd><p><code class="docutils literal notranslate"><span class="pre">TARGET_FILE_IF_EXISTS</span></code> evaluates to the output file of the provided GN
target, if the output file exists. If the output file does not exist, the
entire argument that includes this expression is omitted, even if there is
other text or another expression.</p>
<p>For example, consider this expression:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;--database=&lt;TARGET_FILE_IF_EXISTS(//alpha/bravo)&gt;&quot;</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">//alpha/bravo</span></code> target file exists, this might expand to the
following:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;--database=/home/User/project/out/obj/alpha/bravo/bravo.elf&quot;</span>
</pre></div>
</div>
<p>If the <code class="docutils literal notranslate"><span class="pre">//alpha/bravo</span></code> target file does not exist, the entire
<code class="docutils literal notranslate"><span class="pre">--database=</span></code> argument is omitted from the script arguments.</p>
</dd></dl>

<dl class="describe">
<dt>
<code class="sig-name descname">&lt;TARGET_OBJECTS(gn_target)&gt;</code></dt>
<dd><p>Evaluates to the object files of the provided GN target. Expands to a separate
argument for each object file. If the target has no object files, the argument
is omitted entirely. Because it does not expand to a single expression, the
<code class="docutils literal notranslate"><span class="pre">&lt;TARGET_OBJECTS(...)&gt;</span></code> expression may not have leading or trailing text.</p>
<p>For example, the expression</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;&lt;TARGET_OBJECTS(//foo/bar:a_source_set)&gt;&quot;</span>
</pre></div>
</div>
<p>might expand to multiple separate arguments:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="s2">&quot;/home/User/project_root/out/obj/foo/bar/a_source_set.file_a.cc.o&quot;</span>
<span class="s2">&quot;/home/User/project_root/out/obj/foo/bar/a_source_set.file_b.cc.o&quot;</span>
<span class="s2">&quot;/home/User/project_root/out/obj/foo/bar/a_source_set.file_c.cc.o&quot;</span>
</pre></div>
</div>
</dd></dl>

<p><strong>Example</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="p">(</span><span class="s2">&quot;$dir_pw_build/python_script.gni&quot;</span><span class="p">)</span>

<span class="n">pw_python_script</span><span class="p">(</span><span class="s2">&quot;postprocess_main_image&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">script</span> <span class="o">=</span> <span class="s2">&quot;py/postprocess_binary.py&quot;</span>
  <span class="n">args</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;--database&quot;</span><span class="p">,</span>
    <span class="n">rebase_path</span><span class="p">(</span><span class="s2">&quot;my/database.csv&quot;</span><span class="p">),</span>
    <span class="s2">&quot;--binary=&lt;TARGET_FILE(//firmware/images:main)&gt;&quot;</span><span class="p">,</span>
  <span class="p">]</span>
  <span class="n">stamp</span> <span class="o">=</span> <span class="n">true</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="pw-input-group">
<h4>pw_input_group<a class="headerlink" href="#pw-input-group" title="Permalink to this headline">¶</a></h4>
<p><code class="docutils literal notranslate"><span class="pre">pw_input_group</span></code> defines a group of input files which are not directly
processed by the build but are still important dependencies of later build
steps. This is commonly used alongside metadata to propagate file dependencies
through the build graph and force rebuilds on file modifications.</p>
<p>For example <code class="docutils literal notranslate"><span class="pre">pw_docgen</span></code> defines a <code class="docutils literal notranslate"><span class="pre">pw_doc_group</span></code> template which outputs
metadata from a list of input files. The metadata file is not actually part of
the build, and so changes to any of the input files do not trigger a rebuild.
This is problematic, as targets that depend on the metadata should rebuild when
the inputs are modified but GN cannot express this dependency.</p>
<p><code class="docutils literal notranslate"><span class="pre">pw_input_group</span></code> solves this problem by allowing a list of files to be listed
in a target that does not output any build artifacts, causing all dependent
targets to correctly rebuild.</p>
<p><strong>Arguments</strong></p>
<p><code class="docutils literal notranslate"><span class="pre">pw_input_group</span></code> accepts all arguments that can be passed to a <code class="docutils literal notranslate"><span class="pre">group</span></code>
target, as well as requiring one extra:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">inputs</span></code>: List of input files.</p></li>
</ul>
<p><strong>Example</strong></p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">import</span><span class="p">(</span><span class="s2">&quot;$dir_pw_build/input_group.gni&quot;</span><span class="p">)</span>

<span class="n">pw_input_group</span><span class="p">(</span><span class="s2">&quot;foo_metadata&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">metadata</span> <span class="o">=</span> <span class="p">{</span>
    <span class="n">files</span> <span class="o">=</span> <span class="p">[</span>
      <span class="s2">&quot;x.foo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;y.foo&quot;</span><span class="p">,</span>
      <span class="s2">&quot;z.foo&quot;</span><span class="p">,</span>
    <span class="p">]</span>
  <span class="p">}</span>
  <span class="n">inputs</span> <span class="o">=</span> <span class="n">metadata</span><span class="o">.</span><span class="n">files</span>
<span class="p">}</span>
</pre></div>
</div>
<p>Targets depending on <code class="docutils literal notranslate"><span class="pre">foo_metadata</span></code> will rebuild when any of the <code class="docutils literal notranslate"><span class="pre">.foo</span></code>
files are modified.</p>
</div>
</div>
</div>
<div class="section" id="cmake-ninja">
<h2>CMake / Ninja<a class="headerlink" href="#cmake-ninja" title="Permalink to this headline">¶</a></h2>
<p>Pigweed’s CMake support is provided primarily for projects that have an existing
CMake build and wish to integrate Pigweed without switching to a new build
system.</p>
<p>The following command generates Ninja build files in the out/cmake directory.</p>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>cmake -B out/cmake -S /path/to/pigweed -G Ninja
</pre></div>
</div>
<p>Tests can be executed with the <code class="docutils literal notranslate"><span class="pre">pw_run_tests_GROUP</span></code> targets. To run the basic
Pigweed tests, run <code class="docutils literal notranslate"><span class="pre">ninja</span> <span class="pre">-C</span> <span class="pre">out/cmake</span> <span class="pre">pw_run_tests_modules</span></code>.</p>
<div class="section" id="cmake-functions">
<h3>CMake functions<a class="headerlink" href="#cmake-functions" title="Permalink to this headline">¶</a></h3>
<p>CMake convenience functions are defined in <code class="docutils literal notranslate"><span class="pre">pw_build/pigweed.cmake</span></code>.</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">pw_auto_add_simple_module</span></code> – For modules with only one library,
automatically declare the library and its tests.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pw_add_facade</span></code> – Declare a module facade.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pw_add_module_library</span></code> – Add a library that is part of a module.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">pw_add_test</span></code> – Declare a test target.</p></li>
</ul>
<p>See <code class="docutils literal notranslate"><span class="pre">pw_build/pigweed.cmake</span></code> for the complete documentation of these
functions.</p>
<p>Special libraries that do not fit well with these functions are created with the
standard CMake functions, such as <code class="docutils literal notranslate"><span class="pre">add_library</span></code> and <code class="docutils literal notranslate"><span class="pre">target_link_libraries</span></code>.</p>
</div>
<div class="section" id="use-pigweed-from-an-existing-cmake-project">
<h3>Use Pigweed from an existing CMake project<a class="headerlink" href="#use-pigweed-from-an-existing-cmake-project" title="Permalink to this headline">¶</a></h3>
<p>To use Pigweed libraries form a CMake-based project, simply include the Pigweed
repository from a <code class="docutils literal notranslate"><span class="pre">CMakeLists.txt</span></code>.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">path/to/pigweed</span> <span class="s">pigweed</span><span class="p">)</span>
</pre></div>
</div>
<p>All module libraries will be available as <code class="docutils literal notranslate"><span class="pre">module_name</span></code> or
<code class="docutils literal notranslate"><span class="pre">module_name.sublibrary</span></code>.</p>
<p>If desired, modules can be included individually.</p>
<div class="highlight-cmake notranslate"><div class="highlight"><pre><span></span><span class="nb">include</span><span class="p">(</span><span class="s">path/to/pigweed/pw_build/pigweed.cmake</span><span class="p">)</span>

<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">path/to/pigweed/pw_some_module</span> <span class="s">pw_some_module</span><span class="p">)</span>
<span class="nb">add_subdirectory</span><span class="p">(</span><span class="s">path/to/pigweed/pw_another_module</span> <span class="s">pw_another_module</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="id1">
<h2>Bazel<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>Bazel is currently very experimental, and only builds for host.</p>
<p>The common configuration for Bazel for all modules is in the <code class="docutils literal notranslate"><span class="pre">pigweed.bzl</span></code>
file. The built-in Bazel rules <code class="docutils literal notranslate"><span class="pre">cc_binary</span></code>, <code class="docutils literal notranslate"><span class="pre">cc_library</span></code>, and <code class="docutils literal notranslate"><span class="pre">cc_test</span></code>
are wrapped with <code class="docutils literal notranslate"><span class="pre">pw_cc_binary</span></code>, <code class="docutils literal notranslate"><span class="pre">pw_cc_library</span></code>, and <code class="docutils literal notranslate"><span class="pre">pw_cc_test</span></code>.
These wrappers add parameters to calls to the compiler and linker.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">BUILD</span></code> file is merely a placeholder and currently does nothing.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pw_bytes/docs.html" class="btn btn-neutral float-right" title="pw_bytes" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pw_boot_armv7m/docs.html" class="btn btn-neutral float-left" title="pw_boot_armv7m" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 The Pigweed Authors

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
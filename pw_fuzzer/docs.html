

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pw_fuzzer &mdash; Pigweed</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pw_hdlc_lite" href="../pw_hdlc_lite/docs.html" />
    <link rel="prev" title="pw_env_setup" href="../pw_env_setup/docs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pigweed
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed.googlesource.com/pigweed/pigweed/+/refs/heads/master">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed-review.googlesource.com">Code Reviews</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/pigweed">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/M9NSeTA">Chat Room</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bugs.chromium.org/p/pigweed/issues/list">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/embedded_cpp_guide.html">Embedded C++ Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/style_guide.html">Code Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_system.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/module_structure.html">Module Structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../module_guides.html">Module Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../docker/docs.html">docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_allocator/docs.html">pw_allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_arduino_build/docs.html">pw_arduino_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert/docs.html">pw_assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_basic/docs.html">pw_assert_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_log/docs.html">pw_assert_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_base64/docs.html">pw_base64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bloat/docs.html">pw_bloat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_blob_store/docs.html">pw_blob_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_boot_armv7m/docs.html">pw_boot_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_build/docs.html">pw_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bytes/docs.html">pw_bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_checksum/docs.html">pw_checksum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cli/docs.html">pw_cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_containers/docs.html">pw_containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception/docs.html">pw_cpu_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception_armv7m/docs.html">pw_cpu_exception_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_docgen/docs.html">pw_docgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_doctor/docs.html">pw_doctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_env_setup/docs.html">pw_env_setup</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">pw_fuzzer</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#writing-fuzzers">Writing fuzzers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#building-fuzzers">Building fuzzers</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-fuzzers-locally">Running fuzzers locally</a></li>
<li class="toctree-l3"><a class="reference internal" href="#running-fuzzers-on-oss-fuzz">Running fuzzers on OSS-Fuzz</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hdlc_lite/docs.html">pw_hdlc_lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hex_dump/docs.html">pw_hex_dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_kvs/docs.html">pw_kvs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log/docs.html">pw_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_basic/docs.html">pw_log_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_null/docs.html">pw_log_null</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_rpc/docs.html">pw_log_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_tokenized/docs.html">pw_log_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_metric/docs.html">pw_metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_minimal_cpp_stdlib/docs.html">pw_minimal_cpp_stdlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_module/docs.html">pw_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_polyfill/docs.html">pw_polyfill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_preprocessor/docs.html">pw_preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_presubmit/docs.html">pw_presubmit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf/docs.html">pw_protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf_compiler/docs.html">pw_protobuf_compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_random/docs.html">pw_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_result/docs.html">pw_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_ring_buffer/docs.html">pw_ring_buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_rpc/docs.html">pw_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_span/docs.html">pw_span</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_status/docs.html">pw_status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_stream/docs.html">pw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_string/docs.html">pw_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io/docs.html">pw_sys_io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_arduino/docs.html">pw_sys_io_arduino</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_baremetal_stm32f429/docs.html">pw_sys_io_baremetal_stm32f429</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_stdio/docs.html">pw_sys_io_stdio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_target_runner/docs.html">pw_target_runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_tokenizer/docs.html">pw_tokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_toolchain/docs.html">pw_toolchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace/docs.html">pw_trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace_tokenized/docs.html">pw_trace_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_unit_test/docs.html">pw_unit_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_varint/docs.html">pw_varint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_watch/docs.html">pw_watch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_web_ui/docs.html">pw_web_ui</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pigweed</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../module_guides.html">Module Guides</a> &raquo;</li>
        
      <li>pw_fuzzer</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pw-fuzzer">
<span id="module-pw-fuzzer"></span><h1>pw_fuzzer<a class="headerlink" href="#pw-fuzzer" title="Permalink to this headline">¶</a></h1>
<p><code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code> provides developers with tools to write <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html">libFuzzer</a> based
fuzzers.</p>
<p>Fuzzing or fuzz testing is style of testing that stochastically generates inputs
to targeted interfaces in order to automatically find defects and/or
vulnerabilities. In other words, fuzzing is simply an automated way of testing
APIs with generated data.</p>
<p>A fuzzer is a program that is used to fuzz a interface. It typically has three
steps that it executes repeatedly:</p>
<ol class="arabic simple">
<li><p>Generate a new, context-free input. This is the <em>fuzzing engine</em>. For
<code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code>, this is <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html">libFuzzer</a>.</p></li>
<li><p>Use the input to exercise the targeted interface, or code being tested. This
is the <em>fuzz target function</em>. For <code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code>, these are the GN
<code class="docutils literal notranslate"><span class="pre">sources</span></code> and/or <code class="docutils literal notranslate"><span class="pre">deps</span></code> that define <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#fuzz-target">LLVMFuzzerTestOneInput</a>.</p></li>
<li><p>Monitor the code being tested for any abnormal conditions. This is the
<em>instrumentation</em>. For <code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code>, these are sanitizer runtimes from
LLVM’s <a class="reference external" href="https://compiler-rt.llvm.org/">compiler_rt</a>.</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code> is currently only supported on Linux using clang.</p>
</div>
<img alt="Coverage Guided Fuzzing with libFuzzer" class="align-left" src="../_images/pw_fuzzer_coverage_guided.png" />
<div class="section" id="writing-fuzzers">
<h2>Writing fuzzers<a class="headerlink" href="#writing-fuzzers" title="Permalink to this headline">¶</a></h2>
<p>To write a fuzzer, a developer needs to write a fuzz target function follwing
the <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#fuzz-target">fuzz target function</a> guidelines given by libFuzzer:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extern</span> <span class="s2">&quot;C&quot;</span> <span class="nb">int</span> <span class="n">LLVMFuzzerTestOneInput</span><span class="p">(</span><span class="n">const</span> <span class="n">uint8_t</span> <span class="o">*</span><span class="n">data</span><span class="p">,</span> <span class="n">size_t</span> <span class="n">size</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">DoSomethingInterestingWithMyAPI</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">size</span><span class="p">);</span>
  <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>  <span class="o">//</span> <span class="n">Non</span><span class="o">-</span><span class="n">zero</span> <span class="k">return</span> <span class="n">values</span> <span class="n">are</span> <span class="n">reserved</span> <span class="k">for</span> <span class="n">future</span> <span class="n">use</span><span class="o">.</span>
<span class="p">}</span>
</pre></div>
</div>
<p>When writing you fuzz target function, you may want to consider:</p>
<ul class="simple">
<li><p>It is acceptable to return early if the input doesn’t mean some constraints,
e.g. it is too short.</p></li>
<li><p>If your fuzzer accepts data with a well-defined format, you can bootstrap
coverage by crafting examples and adding them to a <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#corpus">corpus</a>.</p></li>
<li><p>There are tools to <a class="reference external" href="https://github.com/google/fuzzing/blob/master/docs/split-inputs.md">split a fuzzing input</a> into multiple fields if needed;
the <a class="reference external" href="https://github.com/llvm/llvm-project/blob/master/compiler-rt/include/fuzzer/FuzzedDataProvider.h">FuzzedDataProvider</a> is particularly easy to use.</p></li>
<li><p>If your code acts on “transformed” inputs, such as encoded or compressed
inputs, you may want to try <cite>structure aware fuzzing</cite>.</p></li>
<li><p>You can do <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#startup-initialization">startup initialization</a> if you need to.</p></li>
<li><p>If your code is non-deterministic or uses checksums, you may want to disable
those <strong>only</strong> when fuzzing by using LLVM’s
<a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#fuzzer-friendly-build-mode">FUZZING_BUILD_MODE_UNSAFE_FOR_PRODUCTION</a></p></li>
</ul>
</div>
<div class="section" id="building-fuzzers">
<span id="build"></span><h2>Building fuzzers<a class="headerlink" href="#building-fuzzers" title="Permalink to this headline">¶</a></h2>
<p>To build a fuzzer, do the following:</p>
<ol class="arabic simple">
<li><p>Add the GN target using <code class="docutils literal notranslate"><span class="pre">pw_fuzzer</span></code> GN template, and add it to your the
test group of the module:</p></li>
</ol>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># In $dir_my_module/BUILD.gn</span>
<span class="n">import</span><span class="p">(</span><span class="s2">&quot;$dir_pw_fuzzer/fuzzer.gni&quot;</span><span class="p">)</span>

<span class="n">pw_fuzzer</span><span class="p">(</span><span class="s2">&quot;my_fuzzer&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">sources</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;my_fuzzer.cc&quot;</span> <span class="p">]</span>
  <span class="n">deps</span> <span class="o">=</span> <span class="p">[</span> <span class="s2">&quot;:my_lib&quot;</span> <span class="p">]</span>
<span class="p">}</span>

<span class="n">pw_test_group</span><span class="p">(</span><span class="s2">&quot;tests&quot;</span><span class="p">)</span> <span class="p">{</span>
  <span class="n">tests</span> <span class="o">=</span> <span class="p">[</span>
    <span class="s2">&quot;:existing_tests&quot;</span><span class="p">,</span> <span class="o">...</span>
    <span class="s2">&quot;:my_fuzzer&quot;</span><span class="p">,</span>     <span class="c1"># &lt;- Added!</span>
  <span class="p">]</span>
<span class="p">}</span>
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Select the clang toolchain and a sanitizer of your choice. See LLVM for
<a class="reference external" href="https://gcc.gnu.org/onlinedocs/gcc/Instrumentation-Options.html">valid options</a>.</p></li>
</ol>
<div class="highlight-sh notranslate"><div class="highlight"><pre><span></span>$ gn gen out/host --args<span class="o">=</span><span class="s1">&#39;pw_target_toolchain=&quot;//pw_toolchain:host_clang_og&quot; pw_sanitizer=&quot;address&quot;&#39;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Build normally, e.g. using <code class="docutils literal notranslate"><span class="pre">pw</span> <span class="pre">watch</span></code>.</p></li>
</ol>
</div>
<div class="section" id="running-fuzzers-locally">
<span id="run"></span><h2>Running fuzzers locally<a class="headerlink" href="#running-fuzzers-locally" title="Permalink to this headline">¶</a></h2>
<p>Based on the example above, the fuzzer output will be at
<code class="docutils literal notranslate"><span class="pre">out/host/obj/my_module/my_fuzzer</span></code>. It can be invoked using the normal
<a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#options">libFuzzer options</a> and <a class="reference external" href="https://github.com/google/sanitizers/wiki/SanitizerCommonFlags">sanitizer runtime flags</a>. For even more details, see
the libFuzzer section on <a class="reference external" href="https://llvm.org/docs/LibFuzzer.html#running">running a fuzzer</a>.</p>
<p>For example, the following invocation disables “one definition rule” detection,
saves failing inputs to <code class="docutils literal notranslate"><span class="pre">artifacts/</span></code>, treats any input that takes longer than
10 seconds as a failure, and stores the working corpus in <code class="docutils literal notranslate"><span class="pre">corpus/</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ASAN_OPTIONS=detect_odr_violation=0 ./out/host/obj/pw_fuzzer/toy_fuzzer -artifact_prefix=artifacts/ -timeout=10 corpus
INFO: Seed: 305325345
INFO: Loaded 1 modules   (46 inline 8-bit counters): 46 [0x38dfc0, 0x38dfee),
INFO: Loaded 1 PC tables (46 PCs): 46 [0x23aaf0,0x23add0),
INFO:        0 files found in corpus
INFO: -max_len is not provided; libFuzzer will not generate inputs larger than 4096 bytes
INFO: A corpus is not provided, starting from an empty corpus
#2      INITED cov: 2 ft: 3 corp: 1/1b exec/s: 0 rss: 27Mb
#4      NEW    cov: 3 ft: 4 corp: 2/3b lim: 4 exec/s: 0 rss: 27Mb L: 2/2 MS: 2 ShuffleBytes-InsertByte-
#11     NEW    cov: 7 ft: 8 corp: 3/7b lim: 4 exec/s: 0 rss: 27Mb L: 4/4 MS: 2 EraseBytes-CrossOver-
#27     REDUCE cov: 7 ft: 8 corp: 3/6b lim: 4 exec/s: 0 rss: 27Mb L: 3/3 MS: 1 EraseBytes-
#29     REDUCE cov: 7 ft: 8 corp: 3/5b lim: 4 exec/s: 0 rss: 27Mb L: 2/2 MS: 2 ChangeBit-EraseBytes-
#445    REDUCE cov: 9 ft: 10 corp: 4/13b lim: 8 exec/s: 0 rss: 27Mb L: 8/8 MS: 1 InsertRepeatedBytes-
#12104  NEW    cov: 11 ft: 12 corp: 5/24b lim: 122 exec/s: 0 rss: 28Mb L: 11/11 MS: 4 CMP-InsertByte-ShuffleBytes-ChangeByte- DE: &quot;\xff\xff&quot;-
#12321  NEW    cov: 12 ft: 13 corp: 6/31b lim: 122 exec/s: 0 rss: 28Mb L: 7/11 MS: 2 CopyPart-EraseBytes-
#12459  REDUCE cov: 12 ft: 13 corp: 6/28b lim: 122 exec/s: 0 rss: 28Mb L: 8/8 MS: 3 CMP-InsertByte-EraseBytes- DE: &quot;\x00\x00&quot;-
#12826  REDUCE cov: 12 ft: 13 corp: 6/26b lim: 122 exec/s: 0 rss: 28Mb L: 5/8 MS: 2 ShuffleBytes-EraseBytes-
#14824  REDUCE cov: 12 ft: 13 corp: 6/25b lim: 135 exec/s: 0 rss: 28Mb L: 4/8 MS: 3 PersAutoDict-ShuffleBytes-EraseBytes- DE: &quot;\x00\x00&quot;-
#15106  REDUCE cov: 12 ft: 13 corp: 6/24b lim: 135 exec/s: 0 rss: 28Mb L: 3/8 MS: 2 ChangeByte-EraseBytes-
...
#197809 REDUCE cov: 35 ft: 36 corp: 22/129b lim: 1800 exec/s: 0 rss: 79Mb L: 9/9 MS: 1 InsertByte-
#216250 REDUCE cov: 35 ft: 36 corp: 22/128b lim: 1980 exec/s: 0 rss: 87Mb L: 8/8 MS: 1 EraseBytes-
#242761 REDUCE cov: 35 ft: 36 corp: 22/127b lim: 2237 exec/s: 0 rss: 101Mb L: 7/8 MS: 1 EraseBytes-
==126148== ERROR: libFuzzer: deadly signal
    #0 0x35b981 in __sanitizer_print_stack_trace ../recipe_cleanup/clangFu99hg/llvm_build_dir/tools/clang/stage2-bins/runtimes/runtimes-x86_64-unknown-linux-gnu-bins/compiler-rt/lib/asan/asan_stack.cpp:86:3
    #1 0x2bcdb5 in fuzzer::PrintStackTrace() (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2bcdb5)
    #2 0x2a2ac9 in fuzzer::Fuzzer::CrashCallback() (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2a2ac9)
    #3 0x7f866684151f  (/lib/x86_64-linux-gnu/libpthread.so.0+0x1351f)
    #4 0x3831df in (anonymous namespace)::toy_example(char const*, char const*) /home/aarongreen/src/pigweed/out/host/../../pw_fuzzer/examples/toy_fuzzer.cc:49:15
    #5 0x3831df in LLVMFuzzerTestOneInput /home/aarongreen/src/pigweed/out/host/../../pw_fuzzer/examples/toy_fuzzer.cc:80:3
    #6 0x2a4025 in fuzzer::Fuzzer::ExecuteCallback(unsigned char const*, unsigned long) (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2a4025)
    #7 0x2a3774 in fuzzer::Fuzzer::RunOne(unsigned char const*, unsigned long, bool, fuzzer::InputInfo*, bool*) (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2a3774)
    #8 0x2a5769 in fuzzer::Fuzzer::MutateAndTestOne() (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2a5769)
    #9 0x2a6185 in fuzzer::Fuzzer::Loop(std::__Fuzzer::vector&lt;fuzzer::SizedFile, fuzzer::fuzzer_allocator&lt;fuzzer::SizedFile&gt; &gt;&amp;) (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x2a6185)
    #10 0x294c8a in fuzzer::FuzzerDriver(int*, char***, int (*)(unsigned char const*, unsigned long)) (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x294c8a)
    #11 0x2bd422 in main ../recipe_cleanup/clangFu99hg/llvm_build_dir/tools/clang/stage2-bins/runtimes/runtimes-x86_64-unknown-linux-gnu-bins/compiler-rt/lib/fuzzer/FuzzerMain.cpp:19:10
    #12 0x7f8666684bba in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x26bba)
    #13 0x26ae19 in _start (/home/aarongreen/src/pigweed/out/host/obj/pw_fuzzer/toy_fuzzer+0x26ae19)

NOTE: libFuzzer has rudimentary signal handlers.
      Combine libFuzzer with AddressSanitizer or similar for better crash reports.
SUMMARY: libFuzzer: deadly signal
MS: 1 CrossOver-; base unit: 9f479f7a6e3a21363397a25da3168218ba182a16
0x68,0x65,0x6c,0x6c,0x6f,0x0,0x77,0x6f,0x72,0x6c,0x64,0x0,0x0,0x0,
hello\x00world\x00\x00\x00
artifact_prefix=&#39;artifacts&#39;; Test unit written to artifacts/crash-6e4fdc7ffd04131ea15dd243a0890b1b606f4831
Base64: aGVsbG8Ad29ybGQAAAA=
</pre></div>
</div>
</div>
<div class="section" id="running-fuzzers-on-oss-fuzz">
<h2>Running fuzzers on OSS-Fuzz<a class="headerlink" href="#running-fuzzers-on-oss-fuzz" title="Permalink to this headline">¶</a></h2>
<p>Pigweed is integrated with <a class="reference external" href="https://github.com/google/oss-fuzz">OSS-Fuzz</a>, a continuous fuzzing infrastructure for
open source software. Fuzzers listed in in <code class="docutils literal notranslate"><span class="pre">pw_test_groups</span></code> will automatically
start being run within a day or so of appearing in the git repository.</p>
<p>Bugs produced by OSS-Fuzz can be found in its <a class="reference external" href="https://bugs.chromium.org/p/oss-fuzz">Monorail instance</a>. These bugs
include:</p>
<ul class="simple">
<li><p>A detailed report, including a symbolized backtrace.</p></li>
<li><p>A revision range indicating when the bug has been detected.</p></li>
<li><p>A minimized testcase, which is a fuzzer input that can be used to reproduce
the bug.</p></li>
</ul>
<p>To reproduce a bug:</p>
<ol class="arabic simple">
<li><p><a class="reference internal" href="#build">Build</a> the fuzzers as described above.</p></li>
<li><p>Download the minimized testcase.</p></li>
<li><p><a class="reference internal" href="#run">Run</a> the fuzzer with the testcase as an argument.</p></li>
</ol>
<p>For example, if the testcase is saved as “~/Downloads/testcase”
and the fuzzer is the same as in the examples above, you could run:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ ./out/host/obj/pw_fuzzer/toy_fuzzer ~/Downloads/testcase
</pre></div>
</div>
<p>If you need to recreate the OSS-Fuzz environment locally, you can use its
documentation on <a class="reference external" href="https://google.github.io/oss-fuzz/advanced-topics/reproducing/">reproducing</a> issues.</p>
<p>In particular, you can recreate the OSS-Fuzz environment using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python infra/helper.py pull_images
$ python infra/helper.py build_image pigweed
$ python infra/helper.py build_fuzzers --sanitizer &lt;address/undefined&gt; pigweed
</pre></div>
</div>
<p>With that environment, you can run the reproduce bugs using:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">python</span> <span class="n">infra</span><span class="o">/</span><span class="n">helper</span><span class="o">.</span><span class="n">py</span> <span class="n">reproduce</span> <span class="n">pigweed</span> <span class="o">&lt;</span><span class="n">pw_module</span><span class="o">&gt;</span><span class="n">_</span><span class="o">&lt;</span><span class="n">fuzzer_name</span><span class="o">&gt;</span> <span class="o">~/</span><span class="n">Downloads</span><span class="o">/</span><span class="n">testcase</span>
</pre></div>
</div>
<p>You can even verify fixes in your local source checkout:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>$ python infra/helper.py build_fuzzers --sanitizer &lt;address/undefined&gt; pigweed $PW_ROOT
$ python infra/helper.py reproduce pigweed &lt;pw_module&gt;_&lt;fuzzer_name&gt; ~/Downloads/testcase
</pre></div>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pw_hdlc_lite/docs.html" class="btn btn-neutral float-right" title="pw_hdlc_lite" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pw_env_setup/docs.html" class="btn btn-neutral float-left" title="pw_env_setup" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 The Pigweed Authors

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
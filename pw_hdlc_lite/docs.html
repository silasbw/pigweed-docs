

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pw_hdlc_lite &mdash; Pigweed</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="RPC over HDLC example project" href="rpc_example/docs.html" />
    <link rel="prev" title="pw_fuzzer" href="../pw_fuzzer/docs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pigweed
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed.googlesource.com/pigweed/pigweed/+/refs/heads/master">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed-review.googlesource.com">Code Reviews</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/pigweed">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/M9NSeTA">Chat Room</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bugs.chromium.org/p/pigweed/issues/list">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/embedded_cpp_guide.html">Embedded C++ Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/style_guide.html">Code Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_system.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/module_structure.html">Module Structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../module_guides.html">Module Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../docker/docs.html">docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_allocator/docs.html">pw_allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_arduino_build/docs.html">pw_arduino_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert/docs.html">pw_assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_basic/docs.html">pw_assert_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_log/docs.html">pw_assert_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_base64/docs.html">pw_base64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bloat/docs.html">pw_bloat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_blob_store/docs.html">pw_blob_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_boot_armv7m/docs.html">pw_boot_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_build/docs.html">pw_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bytes/docs.html">pw_bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_checksum/docs.html">pw_checksum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cli/docs.html">pw_cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_containers/docs.html">pw_containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception/docs.html">pw_cpu_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception_armv7m/docs.html">pw_cpu_exception_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_docgen/docs.html">pw_docgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_doctor/docs.html">pw_doctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_env_setup/docs.html">pw_env_setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_fuzzer/docs.html">pw_fuzzer</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">pw_hdlc_lite</a><ul>
<li class="toctree-l3"><a class="reference internal" href="rpc_example/docs.html">RPC over HDLC example project</a></li>
<li class="toctree-l3"><a class="reference internal" href="#protocol-description">Protocol Description</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#frames">Frames</a></li>
<li class="toctree-l4"><a class="reference internal" href="#encoding-and-sending-data">Encoding and sending data</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decoding-received-bytes">Decoding received bytes</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#api-usage">API Usage</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#encoder">Encoder</a></li>
<li class="toctree-l4"><a class="reference internal" href="#decoder">Decoder</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#additional-features">Additional features</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#pw-stream-sysiowriter">pw::stream::SysIoWriter</a></li>
<li class="toctree-l4"><a class="reference internal" href="#hdlcrpcclient">HdlcRpcClient</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#roadmap">Roadmap</a></li>
<li class="toctree-l3"><a class="reference internal" href="#compatibility">Compatibility</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hex_dump/docs.html">pw_hex_dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_kvs/docs.html">pw_kvs</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log/docs.html">pw_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_basic/docs.html">pw_log_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_null/docs.html">pw_log_null</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_rpc/docs.html">pw_log_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_tokenized/docs.html">pw_log_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_metric/docs.html">pw_metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_minimal_cpp_stdlib/docs.html">pw_minimal_cpp_stdlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_module/docs.html">pw_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_polyfill/docs.html">pw_polyfill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_preprocessor/docs.html">pw_preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_presubmit/docs.html">pw_presubmit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf/docs.html">pw_protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf_compiler/docs.html">pw_protobuf_compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_random/docs.html">pw_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_result/docs.html">pw_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_ring_buffer/docs.html">pw_ring_buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_rpc/docs.html">pw_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_span/docs.html">pw_span</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_status/docs.html">pw_status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_stream/docs.html">pw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_string/docs.html">pw_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io/docs.html">pw_sys_io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_arduino/docs.html">pw_sys_io_arduino</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_baremetal_stm32f429/docs.html">pw_sys_io_baremetal_stm32f429</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_stdio/docs.html">pw_sys_io_stdio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_target_runner/docs.html">pw_target_runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_tokenizer/docs.html">pw_tokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_toolchain/docs.html">pw_toolchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace/docs.html">pw_trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace_tokenized/docs.html">pw_trace_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_unit_test/docs.html">pw_unit_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_varint/docs.html">pw_varint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_watch/docs.html">pw_watch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_web_ui/docs.html">pw_web_ui</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pigweed</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../module_guides.html">Module Guides</a> &raquo;</li>
        
      <li>pw_hdlc_lite</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pw-hdlc-lite">
<span id="module-pw-hdlc-lite"></span><h1>pw_hdlc_lite<a class="headerlink" href="#pw-hdlc-lite" title="Permalink to this headline">¶</a></h1>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/High-Level_Data_Link_Control">High-Level Data Link Control (HDLC)</a> is a data link
layer protocol intended for serial communication between devices. HDLC is
standardized as <a class="reference external" href="https://www.iso.org/standard/37010.html">ISO/IEC 13239:2002</a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> module provides a simple, robust frame-oriented
transport that uses a subset of the HDLC protocol. <code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> supports
sending between embedded devices or the host. It can be used with
<a class="reference internal" href="../pw_rpc/docs.html#module-pw-rpc"><span class="std std-ref">pw_rpc</span></a> to enable remote procedure calls (RPCs) on embedded on
devices.</p>
<p><strong>Why use the pw_hdlc_lite module?</strong></p>
<blockquote>
<div><ul class="simple">
<li><p>Enables the transmission of RPCs and other data between devices over serial.</p></li>
<li><p>Detects corruption and data loss.</p></li>
<li><p>Light-weight, simple, and easy to use.</p></li>
<li><p>Supports streaming to transport without buffering, since the length is not
encoded.</p></li>
</ul>
</div></blockquote>
<div class="admonition-try-it-out admonition">
<p class="admonition-title">Try it out!</p>
<p>For an example of how to use HDLC with <a class="reference internal" href="../pw_rpc/docs.html#module-pw-rpc"><span class="std std-ref">pw_rpc</span></a>, see the
<a class="reference internal" href="rpc_example/docs.html#module-pw-hdlc-lite-rpc-example"><span class="std std-ref">RPC over HDLC example project</span></a>.</p>
</div>
<div class="toctree-wrapper compound">
</div>
<div class="section" id="protocol-description">
<h2>Protocol Description<a class="headerlink" href="#protocol-description" title="Permalink to this headline">¶</a></h2>
<div class="section" id="frames">
<h3>Frames<a class="headerlink" href="#frames" title="Permalink to this headline">¶</a></h3>
<p>The HDLC implementation in <code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> supports only HDLC information
frames. These frames are encoded as follows:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>_________________________________________
| | | |                          |    | |...
| | | |                          |    | |... [More frames]
|_|_|_|__________________________|____|_|...
 F A C       Payload              FCS  F

 F = flag byte (0x7e, the ~ character)
 A = address field
 C = control field
 FCS = frame check sequence (CRC-32)
</pre></div>
</div>
</div>
<div class="section" id="encoding-and-sending-data">
<h3>Encoding and sending data<a class="headerlink" href="#encoding-and-sending-data" title="Permalink to this headline">¶</a></h3>
<p>This module first writes an initial frame delimiter byte (0x7E) to indicate the
beginning of the frame. Before sending any of the payload data through serial,
the special bytes are escaped:</p>
<blockquote>
<div><table class="docutils align-default">
<colgroup>
<col style="width: 52%" />
<col style="width: 48%" />
</colgroup>
<thead>
<tr class="row-odd"><th class="head"><p>Unescaped Special Bytes</p></th>
<th class="head"><p>Escaped Special Bytes</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>7E</p></td>
<td><p>7D 5E</p></td>
</tr>
<tr class="row-odd"><td><p>7D</p></td>
<td><p>7D 5D</p></td>
</tr>
</tbody>
</table>
</div></blockquote>
<p>The bytes of the payload are escaped and written in a single pass. The
frame check sequence is calculated, escaped, and written after. After this, a
final frame delimiter byte (0x7E) is written to mark the end of the frame.</p>
</div>
<div class="section" id="decoding-received-bytes">
<h3>Decoding received bytes<a class="headerlink" href="#decoding-received-bytes" title="Permalink to this headline">¶</a></h3>
<p>Frames may be received in multiple parts, so we need to store the received data
in a buffer until the ending frame delimiter (0x7E) is read. When the
<code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> decoder receives data, it unescapes it and adds it to a buffer.
When the frame is complete, it calculates and verifies the frame check sequence
and does the following:</p>
<ul class="simple">
<li><p>If correctly verified, the decoder returns the decoded frame.</p></li>
<li><p>If the checksum verification fails, the frame is discarded and an error is
reported.</p></li>
</ul>
</div>
</div>
<div class="section" id="api-usage">
<h2>API Usage<a class="headerlink" href="#api-usage" title="Permalink to this headline">¶</a></h2>
<p>There are two primary functions of the <code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> module:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Encoding</strong> data by constructing a frame with the escaped payload bytes and
frame check sequence.</p></li>
<li><p><strong>Decoding</strong> data by unescaping the received bytes, verifying the frame
check sequence, and returning successfully decoded frames.</p></li>
</ul>
</div></blockquote>
<div class="section" id="encoder">
<h3>Encoder<a class="headerlink" href="#encoder" title="Permalink to this headline">¶</a></h3>
<p>The Encoder API provides a single function that encodes data as an HDLC
information frame.</p>
<div class="section" id="c">
<h4>C++<a class="headerlink" href="#c" title="Permalink to this headline">¶</a></h4>
<dl class="function">
<dt id="_CPPv4N2pw9hdlc_lite21WriteInformationFrameE7uint8_t13ConstByteSpanRN6stream6WriterE">
<span id="_CPPv3N2pw9hdlc_lite21WriteInformationFrameE7uint8_t13ConstByteSpanRN6stream6WriterE"></span><span id="_CPPv2N2pw9hdlc_lite21WriteInformationFrameE7uint8_t13ConstByteSpanRN6stream6WriterE"></span><span id="pw::hdlc_lite::WriteInformationFrame__uint8_t.ConstByteSpan.stream::WriterR"></span>Status <code class="sig-prename descclassname">hdlc_lite<code class="sig-prename descclassname">::</code></code><code class="sig-name descname">WriteInformationFrame</code><span class="sig-paren">(</span>uint8_t <em>address</em>, ConstByteSpan <em>data</em>, stream::Writer &amp;<em>writer</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N2pw9hdlc_lite21WriteInformationFrameE7uint8_t13ConstByteSpanRN6stream6WriterE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Writes a span of data to a <a class="reference internal" href="../pw_stream/docs.html#module-pw-stream"><span class="std std-ref">pw::stream::Writer</span></a> and
returns the status. This implementation uses the <a class="reference internal" href="../pw_checksum/docs.html#module-pw-checksum"><span class="std std-ref">pw_checksum</span></a>
module to compute the CRC-32 frame check sequence.</p>
</dd></dl>

<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;pw_hdlc_lite/encoder.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pw_hdlc_lite/sys_io_stream.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">pw</span><span class="o">::</span><span class="n">stream</span><span class="o">::</span><span class="n">SysIoWriter</span> <span class="n">serial_writer</span><span class="p">;</span>
  <span class="n">Status</span> <span class="n">status</span> <span class="o">=</span> <span class="n">WriteInformationFrame</span><span class="p">(</span><span class="mi">123</span> <span class="cm">/* address */</span><span class="p">,</span>
                                        <span class="n">data</span><span class="p">,</span>
                                        <span class="n">serial_writer</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">status</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;Writing frame failed! %s&quot;</span><span class="p">,</span> <span class="n">status</span><span class="p">.</span><span class="n">str</span><span class="p">());</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="module-pw_hdlc_lite.encode">
<span id="python"></span><h4>Python<a class="headerlink" href="#module-pw_hdlc_lite.encode" title="Permalink to this headline">¶</a></h4>
<p>The encode module supports encoding HDLC frames.</p>
<dl class="function">
<dt id="pw_hdlc_lite.encode.information_frame">
<code class="sig-prename descclassname">pw_hdlc_lite.encode.</code><code class="sig-name descname">information_frame</code><span class="sig-paren">(</span><em class="sig-param">address: int</em>, <em class="sig-param">data: bytes</em><span class="sig-paren">)</span> &#x2192; bytes<a class="headerlink" href="#pw_hdlc_lite.encode.information_frame" title="Permalink to this definition">¶</a></dt>
<dd><p>Encodes an HDLC I-frame with a CRC-32 frame check sequence.</p>
</dd></dl>

<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">from</span> <span class="nn">pw_hdlc_lite</span> <span class="kn">import</span> <span class="n">encode</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">()</span>
<span class="n">ser</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">encode</span><span class="o">.</span><span class="n">information_frame</span><span class="p">(</span><span class="sa">b</span><span class="s1">&#39;your data here!&#39;</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="section" id="decoder">
<h3>Decoder<a class="headerlink" href="#decoder" title="Permalink to this headline">¶</a></h3>
<p>The decoder class unescapes received bytes and adds them to a buffer. Complete,
valid HDLC frames are yielded as they are received.</p>
<div class="section" id="id1">
<h4>C++<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="_CPPv4N2pw2pw9hdlc_lite7DecoderE">
<span id="_CPPv3N2pw2pw9hdlc_lite7DecoderE"></span><span id="_CPPv2N2pw2pw9hdlc_lite7DecoderE"></span><span id="pw::pw::hdlc_lite::Decoder"></span><em class="property">class </em><code class="sig-prename descclassname">pw::hdlc_lite<code class="sig-prename descclassname">::</code></code><code class="sig-name descname">Decoder</code><a class="headerlink" href="#_CPPv4N2pw2pw9hdlc_lite7DecoderE" title="Permalink to this definition">¶</a><br /></dt>
<dd><dl class="function">
<dt id="_CPPv4N2pw2pw9hdlc_lite7Decoder7ProcessENSt4byteE">
<span id="_CPPv3N2pw2pw9hdlc_lite7Decoder7ProcessENSt4byteE"></span><span id="_CPPv2N2pw2pw9hdlc_lite7Decoder7ProcessENSt4byteE"></span><span id="pw::pw::hdlc_lite::Decoder::Process__std::byte"></span>pw::Result&lt;Frame&gt; <code class="sig-name descname">Process</code><span class="sig-paren">(</span>std::byte <em>b</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N2pw2pw9hdlc_lite7Decoder7ProcessENSt4byteE" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Parses a single byte of an HDLC stream. Returns a Result with the complete
frame if the byte completes a frame. The status is the following:</p>
<blockquote>
<div><ul class="simple">
<li><p>OK - A frame was successfully decoded. The Result contains the Frame,
which is invalidated by the next Process call.</p></li>
<li><p>UNAVAILABLE - No frame is available.</p></li>
<li><p>RESOURCE_EXHAUSTED - A frame completed, but it was too large to fit in
the decoder’s buffer.</p></li>
<li><p>DATA_LOSS - A frame completed, but it was invalid. The frame was
incomplete or the frame check sequence verification failed.</p></li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="_CPPv4N2pw2pw9hdlc_lite7Decoder7ProcessEN2pw13ConstByteSpanERR1FDpRR4Args">
<span id="_CPPv3N2pw2pw9hdlc_lite7Decoder7ProcessEN2pw13ConstByteSpanERR1FDpRR4Args"></span><span id="_CPPv2N2pw2pw9hdlc_lite7Decoder7ProcessEN2pw13ConstByteSpanERR1FDpRR4Args"></span><span id="pw::pw::hdlc_lite::Decoder::Process__pw::ConstByteSpan.FRR.ArgsRRDp"></span>void <code class="sig-name descname">Process</code><span class="sig-paren">(</span>pw::ConstByteSpan <em>data</em>, F &amp;&amp;<em>callback</em>, Args&amp;&amp;... <em>args</em><span class="sig-paren">)</span><a class="headerlink" href="#_CPPv4N2pw2pw9hdlc_lite7Decoder7ProcessEN2pw13ConstByteSpanERR1FDpRR4Args" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Processes a span of data and calls the provided callback with each frame or
error.</p>
</dd></dl>

</dd></dl>

<p>This example demonstrates reading individual bytes from <code class="docutils literal notranslate"><span class="pre">pw::sys_io</span></code> and
decoding HDLC frames:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#include</span> <span class="cpf">&quot;pw_hdlc_lite/decoder.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pw_sys_io/sys_io.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">std</span><span class="o">::</span><span class="n">byte</span> <span class="n">data</span><span class="p">;</span>
  <span class="k">while</span> <span class="p">(</span><span class="nb">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">pw</span><span class="o">::</span><span class="n">sys_io</span><span class="o">::</span><span class="n">ReadByte</span><span class="p">(</span><span class="o">&amp;</span><span class="n">data</span><span class="p">).</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// Log serial reading error</span>
    <span class="p">}</span>
    <span class="n">Result</span><span class="o">&lt;</span><span class="n">Frame</span><span class="o">&gt;</span> <span class="n">decoded_frame</span> <span class="o">=</span> <span class="n">decoder</span><span class="p">.</span><span class="n">Process</span><span class="p">(</span><span class="n">data</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">decoded_frame</span><span class="p">.</span><span class="n">ok</span><span class="p">())</span> <span class="p">{</span>
      <span class="c1">// Handle the decoded frame</span>
    <span class="p">}</span>
  <span class="p">}</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="id2">
<h4>Python<a class="headerlink" href="#id2" title="Permalink to this headline">¶</a></h4>
<dl class="class">
<dt id="pw_hdlc_lite.decode.FrameDecoder">
<em class="property">class </em><code class="sig-prename descclassname">pw_hdlc_lite.decode.</code><code class="sig-name descname">FrameDecoder</code><a class="headerlink" href="#pw_hdlc_lite.decode.FrameDecoder" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes one or more HDLC frames from a stream of data.</p>
<dl class="method">
<dt id="pw_hdlc_lite.decode.FrameDecoder.process">
<code class="sig-name descname">process</code><span class="sig-paren">(</span><em class="sig-param">data: bytes</em><span class="sig-paren">)</span> &#x2192; Iterator[pw_hdlc_lite.decode.Frame]<a class="headerlink" href="#pw_hdlc_lite.decode.FrameDecoder.process" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes and yields HDLC frames, including corrupt frames.</p>
<p>The ok() method on Frame indicates whether it is valid or represents a
frame parsing error.</p>
<dl class="field-list simple">
<dt class="field-odd">Yields</dt>
<dd class="field-odd"><p>Frames, which may be valid (frame.ok()) or corrupt (!frame.ok())</p>
</dd>
</dl>
</dd></dl>

<dl class="method">
<dt id="pw_hdlc_lite.decode.FrameDecoder.process_valid_frames">
<code class="sig-name descname">process_valid_frames</code><span class="sig-paren">(</span><em class="sig-param">data: bytes</em><span class="sig-paren">)</span> &#x2192; Iterator[pw_hdlc_lite.decode.Frame]<a class="headerlink" href="#pw_hdlc_lite.decode.FrameDecoder.process_valid_frames" title="Permalink to this definition">¶</a></dt>
<dd><p>Decodes and yields valid HDLC frames, logging any errors.</p>
</dd></dl>

</dd></dl>

<p>Below is an example using the decoder class to decode data read from serial:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">serial</span>
<span class="kn">from</span> <span class="nn">pw_hdlc_lite</span> <span class="kn">import</span> <span class="n">decode</span>

<span class="n">ser</span> <span class="o">=</span> <span class="n">serial</span><span class="o">.</span><span class="n">Serial</span><span class="p">()</span>
<span class="n">decoder</span> <span class="o">=</span> <span class="n">decode</span><span class="o">.</span><span class="n">FrameDecoder</span><span class="p">()</span>

<span class="k">while</span> <span class="bp">True</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">frame</span> <span class="ow">in</span> <span class="n">decoder</span><span class="o">.</span><span class="n">process_valid_frames</span><span class="p">(</span><span class="n">ser</span><span class="o">.</span><span class="n">read</span><span class="p">()):</span>
        <span class="c1"># Handle the decoded frame</span>
</pre></div>
</div>
</div>
</div>
</div>
<div class="section" id="additional-features">
<h2>Additional features<a class="headerlink" href="#additional-features" title="Permalink to this headline">¶</a></h2>
<div class="section" id="pw-stream-sysiowriter">
<h3>pw::stream::SysIoWriter<a class="headerlink" href="#pw-stream-sysiowriter" title="Permalink to this headline">¶</a></h3>
<p>The <code class="docutils literal notranslate"><span class="pre">SysIoWriter</span></code> C++ class implements the <code class="docutils literal notranslate"><span class="pre">Writer</span></code> interface with
<code class="docutils literal notranslate"><span class="pre">pw::sys_io</span></code>. This Writer may be used by the C++ encoder to send HDLC frames
over serial.</p>
</div>
<div class="section" id="hdlcrpcclient">
<h3>HdlcRpcClient<a class="headerlink" href="#hdlcrpcclient" title="Permalink to this headline">¶</a></h3>
<dl class="class">
<dt id="pw_hdlc_lite.rpc.HdlcRpcClient">
<em class="property">class </em><code class="sig-prename descclassname">pw_hdlc_lite.rpc.</code><code class="sig-name descname">HdlcRpcClient</code><span class="sig-paren">(</span><em class="sig-param">device: BinaryIO, proto_paths_or_modules: Iterable[Union[str, pathlib.Path, module]], output: BinaryIO = &lt;_io.BufferedWriter name='&lt;stdout&gt;'&gt;, channels: Iterable[pw_rpc.descriptors.Channel] = None, client_impl: pw_rpc.client.ClientImpl = None</em><span class="sig-paren">)</span><a class="headerlink" href="#pw_hdlc_lite.rpc.HdlcRpcClient" title="Permalink to this definition">¶</a></dt>
<dd><p>An RPC client configured to run over HDLC.</p>
<dl class="method">
<dt id="pw_hdlc_lite.rpc.HdlcRpcClient.rpcs">
<code class="sig-name descname">rpcs</code><span class="sig-paren">(</span><em class="sig-param">channel_id: int = None</em><span class="sig-paren">)</span> &#x2192; pw_rpc.client.Services<a class="headerlink" href="#pw_hdlc_lite.rpc.HdlcRpcClient.rpcs" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns object for accessing services on the specified channel.</p>
<p>This skips some intermediate layers to make it simpler to invoke RPCs
from an HdlcRpcClient. If only one channel is in use, the channel ID is
not necessary.</p>
</dd></dl>

</dd></dl>

</div>
</div>
<div class="section" id="roadmap">
<h2>Roadmap<a class="headerlink" href="#roadmap" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p><strong>Expanded protocol support</strong> - <code class="docutils literal notranslate"><span class="pre">pw_hdlc_lite</span></code> currently only supports
information frames with a single address byte and control byte. Support for
different frame types and extended address or control fields may be added in
the future.</p></li>
<li><p><strong>Higher performance</strong> - We plan to improve the overall performance of the
decoder and encoder implementations by using SIMD/NEON.</p></li>
</ul>
</div>
<div class="section" id="compatibility">
<h2>Compatibility<a class="headerlink" href="#compatibility" title="Permalink to this headline">¶</a></h2>
<p>C++17</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="rpc_example/docs.html" class="btn btn-neutral float-right" title="RPC over HDLC example project" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pw_fuzzer/docs.html" class="btn btn-neutral float-left" title="pw_fuzzer" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 The Pigweed Authors

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>
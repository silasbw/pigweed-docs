

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>pw_log &mdash; Pigweed</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../_static/jquery.js"></script>
        <script type="text/javascript" src="../_static/underscore.js"></script>
        <script type="text/javascript" src="../_static/doctools.js"></script>
        <script type="text/javascript" src="../_static/language_data.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="pw_log_basic" href="../pw_log_basic/docs.html" />
    <link rel="prev" title="pw_kvs" href="../pw_kvs/docs.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> Pigweed
          

          
          </a>

          
            
            
              <div class="version">
                0.1
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../index.html">Home</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/getting_started.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed.googlesource.com/pigweed/pigweed/+/refs/heads/master">Source Code</a></li>
<li class="toctree-l1"><a class="reference external" href="https://pigweed-review.googlesource.com">Code Reviews</a></li>
<li class="toctree-l1"><a class="reference external" href="https://groups.google.com/forum/#!forum/pigweed">Mailing List</a></li>
<li class="toctree-l1"><a class="reference external" href="https://discord.gg/M9NSeTA">Chat Room</a></li>
<li class="toctree-l1"><a class="reference external" href="https://bugs.chromium.org/p/pigweed/issues/list">Issue Tracker</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CONTRIBUTING.html">Contributing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../CODE_OF_CONDUCT.html">Code of Conduct</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/embedded_cpp_guide.html">Embedded C++ Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/style_guide.html">Code Style</a></li>
<li class="toctree-l1"><a class="reference internal" href="../targets.html">Targets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../build_system.html">Build System</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/faq.html">FAQ</a></li>
<li class="toctree-l1"><a class="reference internal" href="../docs/module_structure.html">Module Structure</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../module_guides.html">Module Guides</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../docker/docs.html">docker</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_allocator/docs.html">pw_allocator</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_arduino_build/docs.html">pw_arduino_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert/docs.html">pw_assert</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_basic/docs.html">pw_assert_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_assert_log/docs.html">pw_assert_log</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_base64/docs.html">pw_base64</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bloat/docs.html">pw_bloat</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_blob_store/docs.html">pw_blob_store</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_boot_armv7m/docs.html">pw_boot_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_build/docs.html">pw_build</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_bytes/docs.html">pw_bytes</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_checksum/docs.html">pw_checksum</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cli/docs.html">pw_cli</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_containers/docs.html">pw_containers</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception/docs.html">pw_cpu_exception</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_cpu_exception_armv7m/docs.html">pw_cpu_exception_armv7m</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_docgen/docs.html">pw_docgen</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_doctor/docs.html">pw_doctor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_env_setup/docs.html">pw_env_setup</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_fuzzer/docs.html">pw_fuzzer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hdlc_lite/docs.html">pw_hdlc_lite</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_hex_dump/docs.html">pw_hex_dump</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_kvs/docs.html">pw_kvs</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">pw_log</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#usage-examples">Usage examples</a></li>
<li class="toctree-l3"><a class="reference internal" href="#layer-diagram-example-stm32f429i-disc1">Layer diagram example: <code class="docutils literal notranslate"><span class="pre">stm32f429i-disc1</span></code></a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-macros">Logging macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#option-macros">Option macros</a></li>
<li class="toctree-l3"><a class="reference internal" href="#logging-attributes">Logging attributes</a></li>
<li class="toctree-l3"><a class="reference internal" href="#design-discussion">Design discussion</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#why-not-use-c-style-stream-logging-operators-like-google-log">Why not use C++ style stream logging operators like Google Log?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-does-the-facade-use-header-redirection-instead-of-c-functions">Why does the facade use header redirection instead of C functions?</a></li>
<li class="toctree-l4"><a class="reference internal" href="#why-is-the-module-name-done-as-a-preprocessor-define-rather-than-an-argument">Why is the module name done as a preprocessor define rather than an argument?</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_basic/docs.html">pw_log_basic</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_null/docs.html">pw_log_null</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_rpc/docs.html">pw_log_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_log_tokenized/docs.html">pw_log_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_metric/docs.html">pw_metric</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_minimal_cpp_stdlib/docs.html">pw_minimal_cpp_stdlib</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_module/docs.html">pw_module</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_polyfill/docs.html">pw_polyfill</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_preprocessor/docs.html">pw_preprocessor</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_presubmit/docs.html">pw_presubmit</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf/docs.html">pw_protobuf</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_protobuf_compiler/docs.html">pw_protobuf_compiler</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_random/docs.html">pw_random</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_result/docs.html">pw_result</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_ring_buffer/docs.html">pw_ring_buffer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_rpc/docs.html">pw_rpc</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_span/docs.html">pw_span</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_status/docs.html">pw_status</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_stream/docs.html">pw_stream</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_string/docs.html">pw_string</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io/docs.html">pw_sys_io</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_arduino/docs.html">pw_sys_io_arduino</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_baremetal_stm32f429/docs.html">pw_sys_io_baremetal_stm32f429</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_sys_io_stdio/docs.html">pw_sys_io_stdio</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_target_runner/docs.html">pw_target_runner</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_tokenizer/docs.html">pw_tokenizer</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_toolchain/docs.html">pw_toolchain</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace/docs.html">pw_trace</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_trace_tokenized/docs.html">pw_trace_tokenized</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_unit_test/docs.html">pw_unit_test</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_varint/docs.html">pw_varint</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_watch/docs.html">pw_watch</a></li>
<li class="toctree-l2"><a class="reference internal" href="../pw_web_ui/docs.html">pw_web_ui</a></li>
</ul>
</li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">Pigweed</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../module_guides.html">Module Guides</a> &raquo;</li>
        
      <li>pw_log</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="pw-log">
<span id="module-pw-log"></span><h1>pw_log<a class="headerlink" href="#pw-log" title="Permalink to this headline">¶</a></h1>
<p>Pigweed’s logging module provides facilities for applications to log
information about the execution of their application. The module is split into
two components:</p>
<ol class="arabic simple">
<li><p>The facade (this module) which is only a macro interface layer</p></li>
<li><p>The backend, provided elsewhere, that implements the low level logging</p></li>
</ol>
<div class="section" id="usage-examples">
<h2>Usage examples<a class="headerlink" href="#usage-examples" title="Permalink to this headline">¶</a></h2>
<p>Here is a typical usage example, showing setting the module name, and using the
long-form names.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PW_LOG_MODULE_NAME &quot;BLE&quot;</span>

<span class="cp">#include</span> <span class="cpf">&quot;pw_log/log.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;Booting...&quot;</span><span class="p">);</span>
  <span class="n">PW_LOG_DEBUG</span><span class="p">(</span><span class="s">&quot;CPU temp: %.2f&quot;</span><span class="p">,</span> <span class="n">cpu_temperature</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">BootFailed</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">PW_LOG_CRITICAL</span><span class="p">(</span><span class="s">&quot;Had trouble booting due to error %d&quot;</span><span class="p">,</span> <span class="n">GetErrorCode</span><span class="p">());</span>
    <span class="n">ReportErrorsAndHalt</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;Successfully booted&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
<p>In <code class="docutils literal notranslate"><span class="pre">.cc</span></code> files, it is possible to dispense with the <code class="docutils literal notranslate"><span class="pre">PW_</span></code> part of the log
names and go for shorter log macros.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PW_LOG_MODULE_NAME &quot;BLE&quot;</span>
<span class="cp">#define PW_LOG_USE_ULTRA_SHORT_NAMES 1</span>

<span class="cp">#include</span> <span class="cpf">&quot;pw_log/log.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">INF</span><span class="p">(</span><span class="s">&quot;Booting...&quot;</span><span class="p">);</span>
  <span class="n">DBG</span><span class="p">(</span><span class="s">&quot;CPU temp: %.2f&quot;</span><span class="p">,</span> <span class="n">cpu_temperature</span><span class="p">);</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">BootFailed</span><span class="p">())</span> <span class="p">{</span>
    <span class="n">CRT</span><span class="p">(</span><span class="s">&quot;Had trouble booting due to error %d&quot;</span><span class="p">,</span> <span class="n">GetErrorCode</span><span class="p">());</span>
    <span class="n">ReportErrorsAndHalt</span><span class="p">();</span>
  <span class="p">}</span>
  <span class="n">INF</span><span class="p">(</span><span class="s">&quot;Successfully booted&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div>
<div class="section" id="layer-diagram-example-stm32f429i-disc1">
<h2>Layer diagram example: <code class="docutils literal notranslate"><span class="pre">stm32f429i-disc1</span></code><a class="headerlink" href="#layer-diagram-example-stm32f429i-disc1" title="Permalink to this headline">¶</a></h2>
<p>Below is an example diagram showing how the modules connect together for the
<code class="docutils literal notranslate"><span class="pre">stm32f429i-disc1</span></code> target, where the <code class="docutils literal notranslate"><span class="pre">pw_log</span></code> backend is <code class="docutils literal notranslate"><span class="pre">pw_log_basic</span></code>.
<code class="docutils literal notranslate"><span class="pre">pw_log_basic</span></code> uses the <code class="docutils literal notranslate"><span class="pre">pw_sys_io</span></code> module to log in plaintext, which in
turn outputs to the STM32F429 bare metal backend for <code class="docutils literal notranslate"><span class="pre">pw_sys_io</span></code>, which is
<code class="docutils literal notranslate"><span class="pre">pw_sys_io_baremetal_stm32f429i</span></code>.</p>
<div><svg height="680" viewBox="0 0 256 680" width="256" xmlns="http://www.w3.org/2000/svg" xmlns:inkspace="http://www.inkscape.org/namespaces/inkscape" xmlns:xlink="http://www.w3.org/1999/xlink">
  <defs id="defs_block">
    <filter height="1.504" id="filter_blur" inkspace:collect="always" width="1.1575" x="-0.07875" y="-0.252">
      <feGaussianBlur id="feGaussianBlur3780" inkspace:collect="always" stdDeviation="4.2" />
    </filter>
  </defs>
  <title>blockdiag</title>
  <desc />
  <rect fill="rgb(170,170,170)" height="460" style="filter:url(#filter_blur)" width="144" x="56" y="30" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="46" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="126" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="206" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="286" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="366" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="446" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="526" />
  <rect fill="rgb(0,0,0)" height="40" stroke="rgb(0,0,0)" style="filter:url(#filter_blur);opacity:0.7;fill-opacity:1" width="128" x="67" y="606" />
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="40" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="61" x="128.5" y="67">App code</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="120" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="45" x="128.5" y="147">pw_log</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="200" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="91" x="128.5" y="227">pw_log_basic</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="280" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="68" x="128.0" y="307">pw_sys_io</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="360" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="76" x="128.0" y="379">pw_sys_io_</text>
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="68" x="128.0" y="395">stm32f429</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="440" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="68" x="128.0" y="467">UART pins</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="520" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="76" x="128.0" y="547">FTDI cable</text>
  <rect fill="rgb(255,255,255)" height="40" stroke="rgb(0,0,0)" width="128" x="64" y="600" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="53" x="128.5" y="627">Minicom</text>
  <path d="M 128 560 L 128 592" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,599 124,592 132,592 128,599" stroke="rgb(0,0,0)" />
  <path d="M 128 80 L 128 112" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,119 124,112 132,112 128,119" stroke="rgb(0,0,0)" />
  <path d="M 128 160 L 128 192" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,199 124,192 132,192 128,199" stroke="rgb(0,0,0)" />
  <path d="M 128 240 L 128 272" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,279 124,272 132,272 128,279" stroke="rgb(0,0,0)" />
  <path d="M 128 320 L 128 352" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,359 124,352 132,352 128,359" stroke="rgb(0,0,0)" />
  <path d="M 128 400 L 128 432" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,439 124,432 132,432 128,439" stroke="rgb(0,0,0)" />
  <path d="M 128 480 L 128 512" fill="none" stroke="rgb(0,0,0)" />
  <polygon fill="rgb(0,0,0)" points="128,519 124,512 132,512 128,519" stroke="rgb(0,0,0)" />
  <text fill="rgb(0,0,0)" font-family="sans-serif" font-size="14" font-style="normal" font-weight="normal" text-anchor="middle" textLength="114" x="128.0" y="37">Microcontroller</text>
</svg>
</div>
</div>
<div class="section" id="logging-macros">
<h2>Logging macros<a class="headerlink" href="#logging-macros" title="Permalink to this headline">¶</a></h2>
<p>These are the primary macros for logging information about the functioning of a
system, intended to be used directly.</p>
<dl class="function">
<dt id="_CPPv46PW_LOG5level5flags3fmtz">
<span id="_CPPv36PW_LOG5level5flags3fmtz"></span><span id="_CPPv26PW_LOG5level5flags3fmtz"></span><span id="PW_LOG__level.flags.fmt.z"></span><code class="sig-name descname">PW_LOG</code><span class="sig-paren">(</span>level, flags, fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv46PW_LOG5level5flags3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>This is the primary mechanism for logging.</p>
<p><em>level</em> - An integer level as defined by <code class="docutils literal notranslate"><span class="pre">pw_log/levels.h</span></code>.</p>
<p><em>flags</em> - Arbitrary flags the backend can leverage. The semantics of these
flags are not defined in the facade, but are instead meant as a general
mechanism for communication bits of information to the logging backend.</p>
<p>Here are some ideas for what a backend might use flags for:</p>
<ul class="simple">
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">HAS_PII</span></code> - A log has personally-identifying data</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">HAS_DII</span></code> - A log has device-identifying data</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">RELIABLE_DELIVERY</span></code> - Ask the backend to ensure the log is
delivered; this may entail blocking other logs.</p></li>
<li><p>Example: <code class="docutils literal notranslate"><span class="pre">BEST_EFFORT</span></code> - Don’t deliver this log if it would mean blocking
or dropping important-flagged logs</p></li>
</ul>
<p><em>fmt</em> - The message to log, which may contain format specifiers like <code class="docutils literal notranslate"><span class="pre">%d</span></code>
or <code class="docutils literal notranslate"><span class="pre">%0.2f</span></code>.</p>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">PW_LOG</span><span class="p">(</span><span class="n">PW_LOG_DEFAULT_FLAGS</span><span class="p">,</span> <span class="n">PW_LOG_LEVEL_INFO</span><span class="p">,</span> <span class="s">&quot;Temp is %d degrees&quot;</span><span class="p">,</span> <span class="n">temp</span><span class="p">);</span>
<span class="n">PW_LOG</span><span class="p">(</span><span class="n">UNRELIABLE_DELIVERY</span><span class="p">,</span> <span class="n">PW_LOG_LEVEL_ERROR</span><span class="p">,</span> <span class="s">&quot;It didn&#39;t work!&quot;</span><span class="p">);</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p><code class="docutils literal notranslate"><span class="pre">PW_LOG()</span></code> should not be used frequently; typically only when adding
flags to a particular message to mark PII or to indicate delivery
guarantees.  For most cases, prefer to use the direct <code class="docutils literal notranslate"><span class="pre">PW_LOG_INFO</span></code> or
<code class="docutils literal notranslate"><span class="pre">PW_LOG_DEBUG</span></code> style macros, which are often implemented more efficiently
in the backend.</p>
</div>
</dd></dl>

<dl class="function">
<dt id="_CPPv412PW_LOG_DEBUG3fmtz">
<span id="_CPPv312PW_LOG_DEBUG3fmtz"></span><span id="_CPPv212PW_LOG_DEBUG3fmtz"></span><span id="PW_LOG_DEBUG__fmt.z"></span><code class="sig-name descname">PW_LOG_DEBUG</code><span class="sig-paren">(</span>fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv412PW_LOG_DEBUG3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPPv411PW_LOG_INFO3fmtz">
<span id="_CPPv311PW_LOG_INFO3fmtz"></span><span id="_CPPv211PW_LOG_INFO3fmtz"></span><span id="PW_LOG_INFO__fmt.z"></span><code class="sig-name descname">PW_LOG_INFO</code><span class="sig-paren">(</span>fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv411PW_LOG_INFO3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPPv411PW_LOG_WARN3fmtz">
<span id="_CPPv311PW_LOG_WARN3fmtz"></span><span id="_CPPv211PW_LOG_WARN3fmtz"></span><span id="PW_LOG_WARN__fmt.z"></span><code class="sig-name descname">PW_LOG_WARN</code><span class="sig-paren">(</span>fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv411PW_LOG_WARN3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPPv412PW_LOG_ERROR3fmtz">
<span id="_CPPv312PW_LOG_ERROR3fmtz"></span><span id="_CPPv212PW_LOG_ERROR3fmtz"></span><span id="PW_LOG_ERROR__fmt.z"></span><code class="sig-name descname">PW_LOG_ERROR</code><span class="sig-paren">(</span>fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv412PW_LOG_ERROR3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd></dd></dl>

<dl class="function">
<dt id="_CPPv415PW_LOG_CRITICAL3fmtz">
<span id="_CPPv315PW_LOG_CRITICAL3fmtz"></span><span id="_CPPv215PW_LOG_CRITICAL3fmtz"></span><span id="PW_LOG_CRITICAL__fmt.z"></span><code class="sig-name descname">PW_LOG_CRITICAL</code><span class="sig-paren">(</span>fmt, ...<span class="sig-paren">)</span><a class="headerlink" href="#_CPPv415PW_LOG_CRITICAL3fmtz" title="Permalink to this definition">¶</a><br /></dt>
<dd><p>Shorthand for <cite>PW_LOG(PW_LOG_DEFAULT_FLAGS, &lt;level&gt;, fmt, …)</cite>.</p>
</dd></dl>

</div>
<div class="section" id="option-macros">
<h2>Option macros<a class="headerlink" href="#option-macros" title="Permalink to this headline">¶</a></h2>
<p>This module defines macros that can be overridden to control the behavior of
<code class="docutils literal notranslate"><span class="pre">pw_log</span></code> statements. To override these macros, add <code class="docutils literal notranslate"><span class="pre">#define</span></code> statements
for them before including headers.</p>
<p>The option macro definitions must be visibile to <code class="docutils literal notranslate"><span class="pre">pw_log/log.h</span></code> the first time
it is included. To handle potential transitive includes, place these
<code class="docutils literal notranslate"><span class="pre">#defines</span></code> before all <code class="docutils literal notranslate"><span class="pre">#include</span></code> statements. This should only be done in
source files, not headers. For example:</p>
<blockquote>
<div><div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Set the pw_log option macros here, before ALL of the #includes.</span>
<span class="cp">#define PW_LOG_MODULE_NAME &quot;Calibration&quot;</span>
<span class="cp">#define PW_LOG_LEVEL PW_LOG_LEVEL_WARN</span>

<span class="cp">#include</span> <span class="cpf">&lt;array&gt;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&lt;random&gt;</span><span class="cp"></span>

<span class="cp">#include</span> <span class="cpf">&quot;devices/hal9000.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pw_log/log.h&quot;</span><span class="cp"></span>
<span class="cp">#include</span> <span class="cpf">&quot;pw_rpc/server.h&quot;</span><span class="cp"></span>

<span class="kt">int</span> <span class="nf">MyFunction</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;hello???&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</div></blockquote>
<dl class="macro">
<dt id="c.PW_LOG_MODULE_NAME">
<code class="sig-name descname">PW_LOG_MODULE_NAME</code><a class="headerlink" href="#c.PW_LOG_MODULE_NAME" title="Permalink to this definition">¶</a></dt>
<dd><p>A string literal module name to use in logs. Log backends may attach this
name to log messages or use it for runtime filtering. Defaults to <code class="docutils literal notranslate"><span class="pre">&quot;&quot;</span></code>. The
<code class="docutils literal notranslate"><span class="pre">PW_LOG_MODULE_NAME_DEFINED</span></code> macro is set to <code class="docutils literal notranslate"><span class="pre">1</span></code> or <code class="docutils literal notranslate"><span class="pre">0</span></code> to indicate
whether <code class="docutils literal notranslate"><span class="pre">PW_LOG_MODULE_NAME</span></code> was overridden.</p>
</dd></dl>

<dl class="macro">
<dt id="c.PW_LOG_DEFAULT_FLAGS">
<code class="sig-name descname">PW_LOG_DEFAULT_FLAGS</code><a class="headerlink" href="#c.PW_LOG_DEFAULT_FLAGS" title="Permalink to this definition">¶</a></dt>
<dd><p>Log flags to use for the <code class="docutils literal notranslate"><span class="pre">PW_LOG_&lt;level&gt;</span></code> macros. Different flags may be
applied when using the <code class="docutils literal notranslate"><span class="pre">PW_LOG</span></code> macro directly.</p>
<p>Log backends use flags to change how they handle individual log messages.
Potential uses include assigning logs priority or marking them as containing
personal information. Defaults to <code class="docutils literal notranslate"><span class="pre">0</span></code>.</p>
</dd></dl>

<dl class="macro">
<dt id="c.PW_LOG_LEVEL">
<code class="sig-name descname">PW_LOG_LEVEL</code><a class="headerlink" href="#c.PW_LOG_LEVEL" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters logs by level. Source files that define <code class="docutils literal notranslate"><span class="pre">PW_LOG_LEVEL</span></code> will display
only logs at or above the chosen level. Log statements below this level will
be compiled out of optimized builds. Defaults to <code class="docutils literal notranslate"><span class="pre">PW_LOG_LEVEL_DEBUG</span></code>.</p>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="cp">#define PW_LOG_LEVEL PW_LOG_LEVEL_INFO</span>

<span class="cp">#include</span> <span class="cpf">&quot;pw_log/log.h&quot;</span><span class="cp"></span>

<span class="kt">void</span> <span class="nf">DoSomething</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">PW_LOG_DEBUG</span><span class="p">(</span><span class="s">&quot;This won&#39;t be logged at all&quot;</span><span class="p">);</span>
  <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;This is INFO level, and will display&quot;</span><span class="p">);</span>
  <span class="n">PW_LOG_WARN</span><span class="p">(</span><span class="s">&quot;This is above INFO level, and will display&quot;</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<dl class="function">
<dt id="c.PW_LOG_ENABLE_IF">
<code class="sig-name descname">PW_LOG_ENABLE_IF</code><span class="sig-paren">(</span>level, flags<span class="sig-paren">)</span><a class="headerlink" href="#c.PW_LOG_ENABLE_IF" title="Permalink to this definition">¶</a></dt>
<dd><p>Filters logs by an arbitrary expression based on <code class="docutils literal notranslate"><span class="pre">level</span></code> and <code class="docutils literal notranslate"><span class="pre">flags</span></code>.
Source files that define <code class="docutils literal notranslate"><span class="pre">PW_LOG_ENABLE_IF(level,</span> <span class="pre">flags)</span></code> will display if
the given expression evaluates true.</p>
<p>Example:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Pigweed&#39;s log facade will call this macro to decide to log or not. In</span>
<span class="c1">// this case, it will drop logs with the PII flag set if display of PII is</span>
<span class="c1">// not enabled for the application.</span>
<span class="cp">#define PW_LOG_ENABLE_IF(level, flags) \</span>
<span class="cp">    (level &gt;= PW_LOG_LEVEL_INFO &amp;&amp; \</span>
<span class="cp">     !((flags &amp; MY_PRODUCT_PII_MASK) &amp;&amp; MY_PRODUCT_LOG_PII_ENABLED)</span>

<span class="cp">#include</span> <span class="cpf">&quot;pw_log/log.h&quot;</span><span class="cp"></span>

<span class="c1">// This define might be supplied by the build system.</span>
<span class="cp">#define MY_PRODUCT_LOG_PII_ENABLED false</span>

<span class="c1">// This is the PII mask bit selected by the application.</span>
<span class="cp">#define MY_PRODUCT_PII_MASK (1 &lt;&lt; 5)</span>

<span class="kt">void</span> <span class="nf">DoSomethingWithSensitiveInfo</span><span class="p">()</span> <span class="p">{</span>
  <span class="n">PW_LOG_DEBUG</span><span class="p">(</span><span class="s">&quot;This won&#39;t be logged at all&quot;</span><span class="p">);</span>
  <span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;This is INFO level, and will display&quot;</span><span class="p">);</span>

  <span class="c1">// In this example, this will not be logged since logging with PII</span>
  <span class="c1">// is disabled by the above macros.</span>
  <span class="n">PW_LOG</span><span class="p">(</span><span class="n">PW_LOG_LEVEL_INFO</span><span class="p">,</span>
         <span class="n">MY_PRODUCT_PII_MASK</span><span class="p">,</span>
         <span class="s">&quot;Sensitive: %d&quot;</span><span class="p">,</span>
         <span class="n">sensitive_info</span><span class="p">);</span>
<span class="p">}</span>
</pre></div>
</div>
</dd></dl>

<div class="admonition attention">
<p class="admonition-title">Attention</p>
<p>At this time, only compile time filtering is supported. In the future, we
plan to add support for runtime filtering.</p>
</div>
</div>
<div class="section" id="logging-attributes">
<h2>Logging attributes<a class="headerlink" href="#logging-attributes" title="Permalink to this headline">¶</a></h2>
<p>The logging facade in Pigweed is designed to facilitate the capture of at least
the following attributes:</p>
<ul class="simple">
<li><p><em>Level</em> - The log level; for example, INFO, DEBUG, ERROR, etc. Typically an
integer</p></li>
<li><p><em>Flags</em> - Bitset for e.g. RELIABLE_DELIVERY, or HAS_PII, or BEST_EFFORT</p></li>
<li><p><em>File</em> - The file where the log was triggered</p></li>
<li><p><em>Line</em> - The line number in the file where the log line occured</p></li>
<li><p><em>Function</em> - What function the log comes from. This is expensive in binary
size to use!</p></li>
<li><p><em>Module</em> - The user-defined module name for the log statement; e.g. “BLE” or
“BAT”</p></li>
<li><p><em>Message</em> - The message itself; with % format arguments</p></li>
<li><p><em>Arguments</em> - The format arguments to message</p></li>
<li><p><em>Thread</em> - For devices running with an RTOS, capturing the thread is very
useful</p></li>
<li><p><em>Others</em> - Processor security level? Maybe Thread is a good proxy for this</p></li>
</ul>
<p>Each backend may decide to capture different attributes to balance the tradeoff
between call site code size, call site run time, wire format size, logging
complexity, and more.</p>
</div>
<div class="section" id="design-discussion">
<h2>Design discussion<a class="headerlink" href="#design-discussion" title="Permalink to this headline">¶</a></h2>
<div class="section" id="why-not-use-c-style-stream-logging-operators-like-google-log">
<h3>Why not use C++ style stream logging operators like Google Log?<a class="headerlink" href="#why-not-use-c-style-stream-logging-operators-like-google-log" title="Permalink to this headline">¶</a></h3>
<p>There are multiple reasons to avoid the C++ stream logging style in embedded,
but the biggest reason is that C++ stream logging defeats log tokenization. By
having the string literals broken up between <code class="docutils literal notranslate"><span class="pre">&lt;&lt;</span></code> operators, tokenization
becomes impossible with current language features.</p>
<p>Consider this example use of Google Log:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">LOG</span><span class="p">(</span><span class="n">INFO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;My temperature is &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">temperature</span> <span class="o">&lt;&lt;</span> <span class="s">&quot;. State: &quot;</span> <span class="o">&lt;&lt;</span> <span class="n">state</span><span class="p">;</span>
</pre></div>
</div>
<p>This log statement has two string literals. It might seem like one could convert
move to tokenization:</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="n">LOG</span><span class="p">(</span><span class="n">INFO</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">TOKEN</span><span class="p">(</span><span class="s">&quot;My temperature is &quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">temperature</span> <span class="o">&lt;&lt;</span> <span class="n">TOKEN</span><span class="p">(</span><span class="s">&quot;. State: &quot;</span><span class="p">)</span> <span class="o">&lt;&lt;</span> <span class="n">state</span><span class="p">;</span>
</pre></div>
</div>
<p>However, this doesn’t work. The key problem is that the tokenization system
needs to allocate the string in a linker section that is excluded from the
final binary, but is in the final ELF executable (and so can be extracted).
Since there is no way to declare a string or array in a different section in
the middle of an experession in C++, it is not possible to tokenize an
expression like the above.</p>
<p>In contrast, the <code class="docutils literal notranslate"><span class="pre">printf</span></code>-style version is a single statement with a single
string constant, which can be expanded by the preprocessor (as part of
<code class="docutils literal notranslate"><span class="pre">pw_tokenizer</span></code>) into a constant array in a special section.</p>
<div class="highlight-cpp notranslate"><div class="highlight"><pre><span></span><span class="c1">// Note: LOG_INFO can be tokenized behind the macro; transparent to users.</span>
<span class="n">PW_LOG_INFO</span><span class="p">(</span><span class="s">&quot;My temperature is %d. State: %s&quot;</span><span class="p">,</span> <span class="n">temperature</span><span class="p">,</span> <span class="n">state</span><span class="p">);</span>
</pre></div>
</div>
<p>Additionally, while Pigweed is mostly C++, it a practical reality that at times
projects using Pigweed will need to log from third-party libraries written in
C. Thus, we also wanted to retain C compatibility.</p>
<p>In summary, printf-style logging is better for Pigweed’s target audience
because it:</p>
<ul class="simple">
<li><p>works with tokenization</p></li>
<li><p>is C compatibile</p></li>
<li><p>has smaller call sites</p></li>
</ul>
<p>The Pigweed authors additionally maintain a C++ stream-style embedded logging
library for compatibility with non-embedded code. While it is effective for
porting server code to microcontrollers quickly, we do not advise embedded
projects use that approach unless absolutely necessary.</p>
<ul class="simple">
<li><p>See also <a class="reference internal" href="../pw_log_tokenized/docs.html#module-pw-log-tokenized"><span class="std std-ref">pw_log_tokenized</span></a> for details on leveraging Pigweed’s
tokenizer module for logging.</p></li>
<li><p>See also <a class="reference internal" href="../pw_tokenizer/docs.html#module-pw-tokenizer"><span class="std std-ref">pw_tokenizer</span></a> for details on Pigweed’s tokenizer,
which is useful for more than just logging.</p></li>
</ul>
</div>
<div class="section" id="why-does-the-facade-use-header-redirection-instead-of-c-functions">
<h3>Why does the facade use header redirection instead of C functions?<a class="headerlink" href="#why-does-the-facade-use-header-redirection-instead-of-c-functions" title="Permalink to this headline">¶</a></h3>
<p>Without header redirection, it is not possible to do sophisticated macro
transforms in the backend. For example, to apply tokenization to log strings,
the backend must define the handling macros. Additionally, compile-time
filtering by log level or flags is not possible without header redirection.
While it may be possible to do the filtering in the facade, that would imply
having the same filtering implementation for all log handling, which is a
restriction we want to avoid.</p>
</div>
<div class="section" id="why-is-the-module-name-done-as-a-preprocessor-define-rather-than-an-argument">
<h3>Why is the module name done as a preprocessor define rather than an argument?<a class="headerlink" href="#why-is-the-module-name-done-as-a-preprocessor-define-rather-than-an-argument" title="Permalink to this headline">¶</a></h3>
<p>APIs are a balance between power and ease of use. In the practical cases we
have seen over the years, most translation units only need to log to one
module, like <code class="docutils literal notranslate"><span class="pre">&quot;BLE&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;PWR&quot;</span></code>, <code class="docutils literal notranslate"><span class="pre">&quot;BAT&quot;</span></code> and so on. Thus, adding the
argument to each macro call seemed like too much. On the other hand, flags are
something that are typically added on a per-log-statement basis, and is why the
flags are added on a per-call basis (though hidden through the high-level
macros).</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../pw_log_basic/docs.html" class="btn btn-neutral float-right" title="pw_log_basic" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="../pw_kvs/docs.html" class="btn btn-neutral float-left" title="pw_kvs" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2020 The Pigweed Authors

    </p>
  </div> 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>